<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Worship Pads</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#080c14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Worship Pads">
<style>
  /* Cinzel fallback ‚Äî usa Georgia/serif quando offline */
  /* Rajdhani fallback ‚Äî usa system-ui/sans-serif quando offline */

  :root {
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --dark: #080c14;
    --dark2: #0d1420;
    --dark3: #12192a;
    --card: #151e30;
    --card2: #1a2540;
    --text: #e8e0d0;
    --text-dim: #8a8070;
    --blue-glow: #3a7bd5;
    --green: #2ecc71;
    --red: #e74c3c;
    --accent: #4a90e2;
  }

  html { font-size: clamp(14px, 4vw, 18px); }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    background-image:
      radial-gradient(ellipse at 20% 50%, rgba(58,123,213,0.06) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(201,168,76,0.05) 0%, transparent 50%);
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    background: linear-gradient(180deg, rgba(201,168,76,0.08) 0%, transparent 100%);
    border-bottom: 1px solid rgba(201,168,76,0.2);
    padding: 12px 16px;
    text-align: center;
    position: sticky; top: 0; z-index: 100;
    backdrop-filter: blur(10px);
  }
  header h1 {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(1rem, 5vw, 1.4rem);
    letter-spacing: clamp(2px, 1vw, 4px);
    color: var(--gold-light);
    text-shadow: 0 0 20px rgba(201,168,76,0.4);
    text-align: center;
  }
  header p { font-size: clamp(0.6rem, 2.5vw, 0.75rem); letter-spacing: 2px; color: var(--text-dim); margin-top: 2px; text-align: center; }

  /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
  html, body { width: 100%; display: flex; flex-direction: column; align-items: center; }
  .app { padding: 12px; width: 100%; max-width: 480px; margin: 0 auto; box-sizing: border-box; }
  header { width: 100%; }

  /* ‚îÄ‚îÄ SECTION TITLES ‚îÄ‚îÄ */
  .sec-title {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(0.6rem, 2.5vw, 0.75rem);
    letter-spacing: clamp(1px, 0.8vw, 3px);
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 8px;
    opacity: 0.8;
    text-align: left;
  }

  /* ‚îÄ‚îÄ KEY SELECTOR ‚îÄ‚îÄ */
  .key-section { margin-bottom: 14px; }
  .keys-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 4px;
  }
  .key-btn {
    background: var(--card);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 6px;
    color: var(--text-dim);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.7rem, 3vw, 0.85rem);
    font-weight: 600;
    padding: 7px 2px;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.5px;
    text-align: center;
  }
  .key-btn:active { transform: scale(0.93); }
  .key-btn.active {
    background: linear-gradient(135deg, var(--gold), #a07830);
    border-color: var(--gold);
    color: var(--dark);
    box-shadow: 0 0 12px rgba(201,168,76,0.4);
  }
  .key-btn.minor { font-size: clamp(0.62rem, 2.5vw, 0.75rem); }

  /* ‚îÄ‚îÄ MODE TOGGLE ‚îÄ‚îÄ */
  .mode-row {
    display: flex; gap: 6px; margin-bottom: 14px;
  }
  .mode-btn {
    flex: 1;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid rgba(201,168,76,0.2);
    background: var(--card);
    color: var(--text-dim);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.75rem, 3vw, 0.9rem);
    font-weight: 600;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }
  .mode-btn.active {
    background: rgba(201,168,76,0.15);
    border-color: var(--gold);
    color: var(--gold-light);
  }

  /* ‚îÄ‚îÄ LAYERS ‚îÄ‚îÄ */
  .layers-section { margin-bottom: 14px; }
  .layer-card {
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    padding: 10px 12px;
    margin-bottom: 8px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .layer-card.active-layer { border-color: rgba(201,168,76,0.3); }
  .layer-card::before {
    content: '';
    position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
    background: var(--gold);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .layer-card.active-layer::before { opacity: 0.7; }

  .layer-header {
    display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
  }
  .layer-num {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(0.6rem, 2.5vw, 0.75rem);
    color: var(--gold);
    min-width: 18px;
  }
  .layer-pad-select {
    flex: 1;
    background: var(--dark3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 6px;
    color: var(--text);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.72rem, 3vw, 0.85rem);
    padding: 5px 8px;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238a8070'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
  }
  .layer-toggle {
    width: 32px; height: 18px;
    background: var(--dark3);
    border-radius: 9px;
    border: 1px solid rgba(255,255,255,0.1);
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .layer-toggle.on { background: rgba(46,204,113,0.3); border-color: var(--green); }
  .layer-toggle::after {
    content: '';
    position: absolute;
    width: 12px; height: 12px;
    border-radius: 50%;
    background: var(--text-dim);
    top: 2px; left: 2px;
    transition: all 0.2s;
  }
  .layer-toggle.on::after { left: 16px; background: var(--green); }

  .layer-controls {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px;
  }
  .ctrl-group { display: flex; flex-direction: column; gap: 3px; }
  .ctrl-label { font-size: clamp(0.58rem, 2.2vw, 0.68rem); letter-spacing: 1px; color: var(--text-dim); text-align: center; }
  .ctrl-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 4px;
    border-radius: 2px;
    background: var(--dark3);
    outline: none;
    cursor: pointer;
  }
  .ctrl-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px; height: 14px;
    border-radius: 50%;
    background: var(--gold);
    cursor: pointer;
    box-shadow: 0 0 6px rgba(201,168,76,0.5);
  }

  /* Fade buttons */
  .fade-btns { display: flex; gap: 4px; }
  .fade-btn {
    flex: 1;
    background: var(--dark3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 5px;
    color: var(--text-dim);
    font-size: clamp(0.6rem, 2.5vw, 0.72rem);
    padding: 4px 2px;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.15s;
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    text-align: center;
  }
  .fade-btn:active { transform: scale(0.95); }
  .fade-btn.fade-in-btn { color: var(--green); border-color: rgba(46,204,113,0.3); }
  .fade-btn.fade-out-btn { color: #e67e22; border-color: rgba(230,126,34,0.3); }

  /* Octave */
  .oct-btns { display: flex; gap: 3px; justify-content: center; }
  .oct-btn {
    background: var(--dark3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 5px;
    color: var(--text-dim);
    font-size: clamp(0.68rem, 2.8vw, 0.8rem);
    padding: 3px 8px;
    cursor: pointer;
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-weight: 600;
    transition: all 0.15s;
    min-width: 28px;
    text-align: center;
  }
  .oct-btn:active { transform: scale(0.9); }
  .oct-val {
    font-size: clamp(0.68rem, 2.8vw, 0.8rem);
    color: var(--gold);
    min-width: 24px;
    text-align: center;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700;
  }

  /* ‚îÄ‚îÄ MASTER CONTROLS ‚îÄ‚îÄ */
  .master-section {
    background: var(--card);
    border: 1px solid rgba(201,168,76,0.15);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 14px;
  }
  .master-row { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
  .master-label { font-size: clamp(0.62rem, 2.5vw, 0.72rem); letter-spacing: 1.5px; color: var(--text-dim); min-width: 55px; }
  .master-slider {
    flex: 1;
    -webkit-appearance: none;
    height: 5px;
    border-radius: 3px;
    background: linear-gradient(to right, var(--gold) 0%, var(--dark3) 0%);
    outline: none;
    cursor: pointer;
  }
  .master-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px; height: 18px;
    border-radius: 50%;
    background: var(--gold-light);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(201,168,76,0.5);
  }
  .master-val { font-size: clamp(0.68rem, 2.8vw, 0.8rem); color: var(--gold); min-width: 30px; text-align: right; }

  /* ‚îÄ‚îÄ TRANSPORT ‚îÄ‚îÄ */
  .transport { display: flex; gap: 10px; margin-bottom: 14px; }
  .play-btn, .stop-btn, .reset-btn {
    flex: 1;
    padding: 14px 8px;
    border-radius: 10px;
    border: none;
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(0.7rem, 3vw, 0.85rem);
    letter-spacing: clamp(1px, 0.8vw, 2px);
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 600;
    text-align: center;
  }
  .play-btn {
    background: linear-gradient(135deg, #1a472a, #27ae60);
    color: #fff;
    border: 2px solid var(--green);
    box-shadow: 0 0 16px rgba(46,204,113,0.2);
  }
  .play-btn.playing {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    box-shadow: 0 0 24px rgba(46,204,113,0.5);
    animation: pulse-green 2s infinite;
  }
  .play-btn.stopped {
    background: linear-gradient(135deg, #5a0a0a, #c0392b);
    border-color: var(--red);
    box-shadow: 0 0 16px rgba(231,76,60,0.3);
  }
  @keyframes pulse-green {
    0%,100% { box-shadow: 0 0 16px rgba(46,204,113,0.4); }
    50% { box-shadow: 0 0 28px rgba(46,204,113,0.7); }
  }
  .stop-btn {
    background: var(--card2);
    color: var(--text-dim);
    border: 1px solid rgba(255,255,255,0.1);
    flex: 0.7;
  }
  .stop-btn:active, .reset-btn:active { transform: scale(0.95); }
  .reset-btn {
    background: var(--card2);
    color: var(--text-dim);
    border: 1px solid rgba(255,255,255,0.1);
    flex: 0.7;
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.68rem, 2.8vw, 0.8rem);
    letter-spacing: 1px;
    text-align: center;
  }
  .play-btn:active { transform: scale(0.97); }

  /* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
  .status-bar {
    text-align: center;
    font-size: clamp(0.65rem, 2.5vw, 0.75rem);
    letter-spacing: 1px;
    color: var(--text-dim);
    padding: 8px;
    background: rgba(0,0,0,0.2);
    border-radius: 6px;
    margin-bottom: 10px;
  }
  .status-bar span { color: var(--gold); }

  /* ‚îÄ‚îÄ PRESETS ‚îÄ‚îÄ */
  .presets-section { margin-bottom: 14px; }
  .presets-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 8px; }
  .preset-slot {
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    padding: 8px 4px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    min-height: 56px;
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px;
  }
  .preset-slot.has-data {
    border-color: rgba(201,168,76,0.25);
    background: linear-gradient(135deg, rgba(201,168,76,0.06), var(--card));
  }
  .preset-slot.has-data:active { transform: scale(0.95); }
  .preset-num {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(0.58rem, 2.3vw, 0.68rem);
    color: var(--gold);
    text-align: center;
  }
  .preset-name {
    font-size: clamp(0.55rem, 2.2vw, 0.65rem);
    color: var(--text-dim);
    word-break: break-all;
    line-height: 1.2;
    max-width: 52px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-align: center;
  }
  .preset-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--gold);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .preset-slot.has-data .preset-dot { opacity: 0.8; }
  .preset-slot.empty-slot .preset-num { opacity: 0.4; }

  .preset-actions { display: flex; gap: 6px; }
  .preset-action-btn {
    flex: 1;
    background: var(--card2);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 7px;
    color: var(--text-dim);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.65rem, 2.5vw, 0.78rem);
    font-weight: 600;
    letter-spacing: 1px;
    padding: 8px 4px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  .preset-action-btn:active { transform: scale(0.95); }
  .preset-action-btn.save-btn {
    color: var(--gold);
    border-color: rgba(201,168,76,0.25);
  }
  .preset-action-btn.delete-btn {
    color: var(--red);
    border-color: rgba(231,76,60,0.2);
  }

  /* Selected preset highlight */
  .preset-slot.selected {
    border-color: var(--gold);
    box-shadow: 0 0 10px rgba(201,168,76,0.25);
  }

  /* ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ */
  .toast {
    position: fixed;
    bottom: 24px; left: 50%; transform: translateX(-50%) translateY(60px);
    background: rgba(20,30,50,0.95);
    border: 1px solid var(--gold);
    border-radius: 20px;
    padding: 10px 20px;
    font-size: clamp(0.7rem, 3vw, 0.82rem);
    color: var(--gold-light);
    letter-spacing: 1px;
    z-index: 200;
    transition: transform 0.3s ease;
    pointer-events: none;
    backdrop-filter: blur(10px);
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* ‚îÄ‚îÄ MODAL (nome do preset) ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 300;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none;
    transition: opacity 0.25s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal-box {
    background: var(--card2);
    border: 1px solid rgba(201,168,76,0.3);
    border-radius: 14px;
    padding: 22px 20px;
    width: clamp(250px, 80vw, 300px);
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
  }
  .modal-title {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(0.75rem, 3vw, 0.9rem);
    color: var(--gold-light);
    letter-spacing: 2px;
    margin-bottom: 14px;
    text-align: center;
  }
  .modal-input {
    width: 100%;
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.82rem, 3.5vw, 0.95rem);
    padding: 10px 12px;
    outline: none;
    margin-bottom: 14px;
    letter-spacing: 1px;
  }
  .modal-input:focus { border-color: var(--gold); }
  .modal-btns { display: flex; gap: 8px; }
  .modal-btn {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
    font-family: 'Rajdhani', 'Segoe UI', system-ui, sans-serif;
    font-size: clamp(0.72rem, 3vw, 0.85rem);
    font-weight: 600;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  .modal-btn.confirm {
    background: linear-gradient(135deg, rgba(201,168,76,0.2), rgba(201,168,76,0.1));
    border-color: var(--gold);
    color: var(--gold-light);
  }
  .modal-btn.cancel {
    background: var(--dark3);
    color: var(--text-dim);
  }

  /* LOADING */
  .loading-overlay {
    position: fixed; inset: 0;
    background: var(--dark);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 999;
    transition: opacity 0.5s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-title {
    font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
    font-size: clamp(1.2rem, 6vw, 1.6rem);
    color: var(--gold-light);
    letter-spacing: clamp(3px, 1.5vw, 6px);
    margin-bottom: 8px;
    text-align: center;
  }
  .loading-sub { color: var(--text-dim); font-size: clamp(0.65rem, 2.5vw, 0.8rem); letter-spacing: 2px; margin-bottom: 30px; text-align: center; }
  .loading-bar-wrap {
    width: clamp(160px, 50vw, 220px); height: 3px;
    background: rgba(255,255,255,0.05);
    border-radius: 2px; overflow: hidden;
  }
  .loading-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), var(--gold-light));
    width: 0%;
    transition: width 0.3s;
    border-radius: 2px;
  }
  .loading-msg { font-size: clamp(0.6rem, 2.2vw, 0.7rem); color: var(--text-dim); margin-top: 10px; letter-spacing: 1px; text-align: center; }
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL: nome do preset -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box">
    <div class="modal-title">SALVAR PRESET</div>
    <input class="modal-input" id="modalInput" type="text" maxlength="16" placeholder="Nome do preset...">
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeModal()">CANCELAR</button>
      <button class="modal-btn confirm" onclick="confirmSave()">SALVAR</button>
    </div>
  </div>
</div>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-title">WORSHIP PADS</div>
  <div class="loading-sub">SPIRITUAL SOUND ENGINE</div>
  <div class="loading-bar-wrap"><div class="loading-bar" id="loadingBar"></div></div>
  <div class="loading-msg" id="loadingMsg">Iniciando...</div>
</div>

<header>
  <h1>WORSHIP PADS</h1>
  <p>SPIRITUAL SOUND ENGINE</p>
</header>



<div class="app">

  <!-- STATUS -->
  <div class="status-bar" id="statusBar">
    Tom: <span id="statusKey">C Maior</span> | Layers ativos: <span id="statusLayers">0</span>
  </div>

  <!-- KEY SELECTOR -->
  <div class="key-section">
    <div class="sec-title">Tonalidade</div>
    <div class="mode-row">
      <button class="mode-btn active" id="btnMajor" onclick="setMode('major')">MAIOR</button>
      <button class="mode-btn" id="btnMinor" onclick="setMode('minor')">MENOR</button>
    </div>
    <div class="keys-grid" id="keysGrid"></div>
  </div>

  <!-- PRESETS -->
  <div class="presets-section">
    <div class="sec-title">Presets Salvos</div>
    <div class="presets-grid" id="presetsGrid"></div>
    <div class="preset-actions">
      <button class="preset-action-btn save-btn" onclick="openSaveModal()">üíæ SALVAR PRESET</button>
      <button class="preset-action-btn" onclick="loadSelectedPreset()">üìÇ CARREGAR</button>
      <button class="preset-action-btn delete-btn" onclick="deleteSelectedPreset()">üóë APAGAR</button>
    </div>
  </div>

  <!-- LAYERS -->
  <div class="layers-section">
    <div class="sec-title">Layers de Mixagem</div>
    <div id="layersContainer"></div>
  </div>

  <!-- MASTER -->
  <div class="master-section">
    <div class="sec-title">Master</div>
    <div class="master-row">
      <div class="master-label">VOLUME</div>
      <input type="range" class="master-slider" id="masterVolume" min="0" max="100" value="80" oninput="updateMaster()">
      <div class="master-val" id="masterVolVal">80%</div>
    </div>
    <div class="master-row">
      <div class="master-label">REVERB</div>
      <input type="range" class="master-slider" id="masterReverb" min="0" max="100" value="40" oninput="updateMaster()">
      <div class="master-val" id="masterRevVal">40%</div>
    </div>
  </div>

  <!-- TRANSPORT -->
  <div class="transport">
    <button class="play-btn" id="playBtn" onclick="togglePlay()">‚ñ∂ PLAY</button>
    <button class="stop-btn" onclick="stopAll()">‚ñ† STOP</button>
    <button class="reset-btn" onclick="resetConfig()">‚Ü∫ RESET</button>
  </div>

</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WORSHIP PADS ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const KEYS = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const KEY_LABELS = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];

// Pad files ‚Äî pasta "audio/" do reposit√≥rio
const PAD_FILES = {
  'ambiente 1':  'audio/ambiente1.mp3',
  'ambiente 2':  'audio/ambiente2.mp3',
  'anjos':       'audio/anjo.mp3',
  'atmosfera':   'audio/atimosfera.mp3',
  'chorim':      'audio/chorim.mp3',
  'grave':       'audio/grave.mp3',
  'guitar':      'audio/guitar.mp3',
  'hard':        'audio/hard.mp3',
  'hillsong':    'audio/hillsong.mp3',
  'motion 1':    'audio/motion1.mp3',
  'motion 2':    'audio/motion2.mp3',
  'piano':       'audio/piano.mp3',
  'reverse':     'audio/reverse.mp3',
  'shimmer':     'audio/shimmer.mp3',
  'shiny':       'audio/shiny.mp3',
  'synth voice': 'audio/syntevoice.mp3',
  'vocoder':     'audio/vovoder.mp3',
  'warm':        'audio/warm.mp3',
  'worship':     'audio/worship.mp3',
};

const PAD_NAMES = Object.keys(PAD_FILES);
const PAD_URLS  = Object.values(PAD_FILES);
const NUM_LAYERS = 6;

// ‚îÄ‚îÄ AudioContext & nodes ‚îÄ‚îÄ
let ctx = null;
let masterGain = null;
let reverbNode = null;
let reverbGain = null;
let dryGain = null;

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let currentKey = 0;   // semitone index 0-11
let currentMode = 'major'; // 'major' | 'minor'
let isPlaying = false;

// Buffers keyed by PAD_URLS index
let audioBuffers = {};

// Layers state
let layers = Array.from({length: NUM_LAYERS}, (_, i) => ({
  id: i,
  enabled: false,
  padIndex: i % PAD_NAMES.length,
  volume: 70,
  fade: 0,    // fade loop duration seconds
  octave: 0,  // -2..+2
  source: null,
  gainNode: null,
  fadeInterval: null,
  fadeDirection: 0, // 0=none, 1=in, -1=out
}));

// ‚îÄ‚îÄ Build Reverb Impulse ‚îÄ‚îÄ
async function buildReverb(ctx, seconds=2.5, decay=3) {
  const len = ctx.sampleRate * seconds;
  const buf = ctx.createBuffer(2, len, ctx.sampleRate);
  for (let c=0; c<2; c++) {
    const d = buf.getChannelData(c);
    for (let i=0; i<len; i++) {
      d[i] = (Math.random()*2-1) * Math.pow(1 - i/len, decay);
    }
  }
  const conv = ctx.createConvolver();
  conv.buffer = buf;
  return conv;
}

// ‚îÄ‚îÄ Init Audio ‚îÄ‚îÄ
async function initAudio() {
  if (ctx) return;
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  masterGain = ctx.createGain();
  masterGain.gain.value = 0.8;

  reverbNode = await buildReverb(ctx);
  reverbGain = ctx.createGain(); reverbGain.gain.value = 0.4;
  dryGain = ctx.createGain(); dryGain.gain.value = 0.8;

  masterGain.connect(dryGain);
  masterGain.connect(reverbNode);
  reverbNode.connect(reverbGain);
  dryGain.connect(ctx.destination);
  reverbGain.connect(ctx.destination);
}

// ‚îÄ‚îÄ Load Buffers ‚îÄ‚îÄ
const failedBuffers = new Set();
async function loadBuffer(url) {
  if (audioBuffers[url]) return audioBuffers[url];
  if (failedBuffers.has(url)) return null;
  try {
    const resp = await fetch(url);
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    const ab = await resp.arrayBuffer();
    const buf = await ctx.decodeAudioData(ab);
    audioBuffers[url] = buf;
    return buf;
  } catch(e) {
    console.warn('Arquivo n√£o encontrado:', url, e.message);
    failedBuffers.add(url);
    const padName = Object.entries(PAD_FILES).find(([k,v])=>v===url)?.[0] || url;
    showToast(`‚ö†Ô∏è "${padName}" n√£o encontrado ‚Äî adicione o MP3 na pasta audio/`);
    return null;
  }
}

// ‚îÄ‚îÄ Playback rate for key transposition + octave ‚îÄ‚îÄ
// Modo menor aplica -3 semitons (relativa menor natural)
function getPlaybackRate(semitoneOffset, octave) {
  const modeOffset = currentMode === 'minor' ? -3 : 0;
  return Math.pow(2, (semitoneOffset + modeOffset + octave*12) / 12);
}

// ‚îÄ‚îÄ Start a layer ‚îÄ‚îÄ
async function startLayer(layer) {
  if (!ctx) return;
  if (layer.source) { try { layer.source.stop(); } catch(e){} layer.source = null; }

  const url = PAD_URLS[layer.padIndex];
  const buf = await loadBuffer(url);
  if (!buf) return;

  const src = ctx.createBufferSource();
  src.buffer = buf;
  src.loop = true;
  src.loopStart = 0;
  src.loopEnd = buf.duration;
  src.playbackRate.value = getPlaybackRate(currentKey, layer.octave);

  const g = ctx.createGain();
  g.gain.value = layer.enabled ? (layer.volume / 100) : 0;
  layer.gainNode = g;

  src.connect(g);
  g.connect(masterGain);
  src.start();
  layer.source = src;
}

// ‚îÄ‚îÄ Stop a layer ‚îÄ‚îÄ
function stopLayer(layer) {
  if (layer.source) {
    try { layer.source.stop(); } catch(e) {}
    layer.source = null;
  }
  layer.gainNode = null;
}

// ‚îÄ‚îÄ Toggle play ‚îÄ‚îÄ
async function togglePlay() {
  if (!ctx) await initAudio();
  if (ctx.state === 'suspended') await ctx.resume();

  if (!isPlaying) {
    isPlaying = true;
    document.getElementById('playBtn').textContent = '‚ñ∂ TOCANDO';
    document.getElementById('playBtn').classList.add('playing');
    document.getElementById('playBtn').classList.remove('stopped');
    for (const layer of layers) {
      if (layer.enabled) await startLayer(layer);
    }
  } else {
    pauseAll();
  }
  updateStatus();
}

function pauseAll() {
  isPlaying = false;
  document.getElementById('playBtn').textContent = '‚ñ† PARADO';
  document.getElementById('playBtn').classList.remove('playing');
  document.getElementById('playBtn').classList.add('stopped');
  for (const layer of layers) stopLayer(layer);
}

function stopAll() {
  pauseAll();
  updateStatus();
}

// ‚îÄ‚îÄ Update key ‚Üí retune all sources ‚îÄ‚îÄ
function retuneSources() {
  for (const layer of layers) {
    if (layer.source) {
      layer.source.playbackRate.value = getPlaybackRate(currentKey, layer.octave);
    }
  }
}

// ‚îÄ‚îÄ Fade loop ‚îÄ‚îÄ
function startFadeLoop(layer) {
  if (layer.fadeInterval) clearInterval(layer.fadeInterval);
  if (!layer.gainNode || layer.fade <= 0) return;

  const STEPS = 60;
  const halfSec = (layer.fade / 2) * 1000;
  const stepMs = halfSec / STEPS;
  let dir = 1; // 1=in, -1=out
  let val = 0;

  layer.fadeInterval = setInterval(() => {
    if (!layer.gainNode) { clearInterval(layer.fadeInterval); return; }
    val += dir * (1/STEPS);
    if (val >= 1) { val = 1; dir = -1; }
    if (val <= 0) { val = 0; dir = 1; }
    layer.gainNode.gain.value = val * (layer.volume / 100);
  }, stepMs);
}

// ‚îÄ‚îÄ Reset config ‚îÄ‚îÄ
function resetConfig() {
  stopAll();
  currentKey = 0;
  currentMode = 'major';
  layers.forEach(l => {
    l.enabled = false;
    l.volume = 70;
    l.fade = 0;
    l.octave = 0;
    l.padIndex = l.id % PAD_NAMES.length;
  });
  document.getElementById('masterVolume').value = 80;
  document.getElementById('masterReverb').value = 40;
  if (masterGain) masterGain.gain.value = 0.8;
  if (reverbGain) reverbGain.gain.value = 0.4;
  selectedPreset = null;
  renderKeys();
  renderLayers();
  renderPresets();
  updateStatus();
  showToast('‚Ü∫ Configura√ß√µes restauradas');
}

// ‚îÄ‚îÄ Master controls ‚îÄ‚îÄ
function updateMaster() {
  const vol = document.getElementById('masterVolume').value;
  const rev = document.getElementById('masterReverb').value;
  document.getElementById('masterVolVal').textContent = vol + '%';
  document.getElementById('masterRevVal').textContent = rev + '%';

  // Update master slider fill
  document.getElementById('masterVolume').style.background =
    `linear-gradient(to right, var(--gold) ${vol}%, var(--dark3) ${vol}%)`;
  document.getElementById('masterReverb').style.background =
    `linear-gradient(to right, var(--gold) ${rev}%, var(--dark3) ${rev}%)`;

  if (masterGain) masterGain.gain.value = vol / 100;
  if (reverbGain) reverbGain.gain.value = rev / 100 * 0.8;
  if (dryGain) dryGain.gain.value = 1 - (rev / 100 * 0.5);
}

// ‚îÄ‚îÄ Mode ‚îÄ‚îÄ
function setMode(mode) {
  currentMode = mode;
  document.getElementById('btnMajor').classList.toggle('active', mode==='major');
  document.getElementById('btnMinor').classList.toggle('active', mode==='minor');
  retuneSources();
  updateStatus();
}

// ‚îÄ‚îÄ Key select ‚îÄ‚îÄ
function setKey(idx) {
  currentKey = idx;
  renderKeys();
  retuneSources();
  updateStatus();
}

// ‚îÄ‚îÄ Status ‚îÄ‚îÄ
function updateStatus() {
  const mode = currentMode === 'major' ? 'Maior' : 'Menor';
  document.getElementById('statusKey').textContent = `${KEY_LABELS[currentKey]} ${mode}`;
  const count = layers.filter(l => l.enabled && isPlaying).length;
  document.getElementById('statusLayers').textContent = count;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function renderKeys() {
  const grid = document.getElementById('keysGrid');
  grid.innerHTML = '';
  KEYS.forEach((k, i) => {
    const btn = document.createElement('button');
    btn.className = 'key-btn' + (i === currentKey ? ' active' : '');
    btn.textContent = k;
    btn.onclick = () => setKey(i);
    grid.appendChild(btn);
  });
}

function renderLayers() {
  const container = document.getElementById('layersContainer');
  container.innerHTML = '';

  layers.forEach(layer => {
    const card = document.createElement('div');
    card.className = 'layer-card' + (layer.enabled ? ' active-layer' : '');
    card.id = `layer-card-${layer.id}`;

    // OPTIONS for pad select
    const opts = PAD_NAMES.map((name, i) =>
      `<option value="${i}" ${i===layer.padIndex?'selected':''}>${name}</option>`
    ).join('');

    card.innerHTML = `
      <div class="layer-header">
        <div class="layer-num">L${layer.id+1}</div>
        <select class="layer-pad-select" id="padSel${layer.id}" onchange="onPadChange(${layer.id}, this.value)">
          ${opts}
        </select>
        <div class="layer-toggle ${layer.enabled?'on':''}" id="layerToggle${layer.id}"
             onclick="toggleLayer(${layer.id})"></div>
      </div>
      <div class="layer-controls">
        <div class="ctrl-group">
          <div class="ctrl-label">VOLUME</div>
          <input type="range" class="ctrl-slider" min="0" max="100" value="${layer.volume}"
            oninput="onLayerVolume(${layer.id}, this.value)">
        </div>
        <div class="ctrl-group">
          <div class="ctrl-label">FADE LOOP</div>
          <div class="fade-btns">
            <button class="fade-btn fade-in-btn" onclick="triggerFade(${layer.id}, 1)">‚ñ≤IN</button>
            <button class="fade-btn fade-out-btn" onclick="triggerFade(${layer.id}, -1)">‚ñºOUT</button>
          </div>
        </div>
        <div class="ctrl-group">
          <div class="ctrl-label">OITAVA</div>
          <div class="oct-btns">
            <button class="oct-btn" onclick="changeOctave(${layer.id},-1)">‚ñº</button>
            <div class="oct-val" id="octVal${layer.id}">${layer.octave>=0?'+':''}${layer.octave}</div>
            <button class="oct-btn" onclick="changeOctave(${layer.id},1)">‚ñ≤</button>
          </div>
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

function onPadChange(id, val) {
  const layer = layers[id];
  layer.padIndex = parseInt(val);
  if (isPlaying && layer.enabled) startLayer(layer);
}

function toggleLayer(id) {
  const layer = layers[id];
  layer.enabled = !layer.enabled;
  const toggle = document.getElementById(`layerToggle${id}`);
  const card = document.getElementById(`layer-card-${id}`);
  toggle.classList.toggle('on', layer.enabled);
  card.classList.toggle('active-layer', layer.enabled);

  if (layer.enabled) {
    if (isPlaying) startLayer(layer);
  } else {
    stopLayer(layer);
    if (layer.fadeInterval) { clearInterval(layer.fadeInterval); layer.fadeInterval = null; }
  }
  updateStatus();
}

function onLayerVolume(id, val) {
  const layer = layers[id];
  layer.volume = parseInt(val);
  if (layer.gainNode) layer.gainNode.gain.value = layer.volume / 100;
}

function triggerFade(id, dir) {
  const layer = layers[id];
  if (!layer.gainNode) return;

  const STEPS = 80;
  const DUR = 4000; // 4 seconds fade
  const stepMs = DUR / STEPS;

  if (layer.fadeInterval) clearInterval(layer.fadeInterval);

  let current = layer.gainNode.gain.value;
  const target = dir === 1 ? (layer.volume/100) : 0;
  const delta = (target - current) / STEPS;

  layer.fadeInterval = setInterval(() => {
    if (!layer.gainNode) { clearInterval(layer.fadeInterval); return; }
    current += delta;
    if ((dir===1 && current >= target) || (dir===-1 && current <= target)) {
      current = target;
      clearInterval(layer.fadeInterval);
      layer.fadeInterval = null;
      if (dir === -1) { /* keep source running at 0 vol */ }
      return;
    }
    layer.gainNode.gain.value = Math.max(0, Math.min(1, current));
  }, stepMs);
}

function changeOctave(id, delta) {
  const layer = layers[id];
  layer.octave = Math.max(-2, Math.min(2, layer.octave + delta));
  document.getElementById(`octVal${id}`).textContent = (layer.octave>=0?'+':'')+layer.octave;
  if (layer.source) layer.source.playbackRate.value = getPlaybackRate(currentKey, layer.octave);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRESETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const NUM_PRESETS = 5;
let selectedPreset = null; // 0-4
let pendingSaveSlot = null;

function getPresets() {
  try { return JSON.parse(localStorage.getItem('worship_presets') || '[]'); }
  catch(e) { return []; }
}

function savePresets(presets) {
  try { localStorage.setItem('worship_presets', JSON.stringify(presets)); }
  catch(e) { showToast('Erro ao salvar!'); }
}

function buildConfig() {
  return {
    key: currentKey,
    mode: currentMode,
    masterVolume: document.getElementById('masterVolume').value,
    masterReverb: document.getElementById('masterReverb').value,
    layers: layers.map(l => ({
      enabled: l.enabled,
      padIndex: l.padIndex,
      volume: l.volume,
      octave: l.octave,
    }))
  };
}

function applyConfig(cfg) {
  currentKey = cfg.key ?? 0;
  currentMode = cfg.mode ?? 'major';

  document.getElementById('masterVolume').value = cfg.masterVolume ?? 80;
  document.getElementById('masterReverb').value = cfg.masterReverb ?? 40;
  updateMaster();

  document.getElementById('btnMajor').classList.toggle('active', currentMode==='major');
  document.getElementById('btnMinor').classList.toggle('active', currentMode==='minor');

  if (cfg.layers) {
    cfg.layers.forEach((lc, i) => {
      if (!layers[i]) return;
      layers[i].enabled = lc.enabled ?? false;
      layers[i].padIndex = lc.padIndex ?? i % PAD_NAMES.length;
      layers[i].volume = lc.volume ?? 70;
      layers[i].octave = lc.octave ?? 0;
    });
  }

  renderKeys();
  renderLayers();
  updateStatus();
}

function renderPresets() {
  const grid = document.getElementById('presetsGrid');
  grid.innerHTML = '';
  const presets = getPresets();

  for (let i = 0; i < NUM_PRESETS; i++) {
    const p = presets[i];
    const slot = document.createElement('div');
    const isSelected = selectedPreset === i;
    slot.className = 'preset-slot ' + (p ? 'has-data' : 'empty-slot') + (isSelected ? ' selected' : '');
    slot.id = `preset-slot-${i}`;
    slot.onclick = () => selectPreset(i);
    slot.innerHTML = `
      <div class="preset-num">P${i+1}</div>
      <div class="preset-dot"></div>
      <div class="preset-name">${p ? p.name : '‚Äî'}</div>
    `;
    grid.appendChild(slot);
  }
}

function selectPreset(idx) {
  selectedPreset = idx;
  renderPresets();
}

function openSaveModal() {
  if (selectedPreset === null) {
    showToast('Selecione um slot (P1‚ÄìP5) primeiro');
    return;
  }
  pendingSaveSlot = selectedPreset;
  const presets = getPresets();
  const existing = presets[pendingSaveSlot];
  document.getElementById('modalInput').value = existing ? existing.name : `Preset ${pendingSaveSlot+1}`;
  document.getElementById('modalOverlay').classList.add('open');
  setTimeout(() => document.getElementById('modalInput').focus(), 100);
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  pendingSaveSlot = null;
}

function confirmSave() {
  const name = document.getElementById('modalInput').value.trim() || `Preset ${pendingSaveSlot+1}`;
  const presets = getPresets();
  // Ensure array is big enough
  while (presets.length <= pendingSaveSlot) presets.push(null);
  presets[pendingSaveSlot] = { name, config: buildConfig() };
  savePresets(presets);
  closeModal();
  renderPresets();
  showToast(`‚úì "${name}" salvo no P${pendingSaveSlot+1}`);
}

function loadSelectedPreset() {
  if (selectedPreset === null) { showToast('Selecione um preset primeiro'); return; }
  const presets = getPresets();
  const p = presets[selectedPreset];
  if (!p) { showToast(`P${selectedPreset+1} est√° vazio`); return; }
  stopAll();
  applyConfig(p.config);
  showToast(`‚úì "${p.name}" carregado`);
}

function deleteSelectedPreset() {
  if (selectedPreset === null) { showToast('Selecione um preset primeiro'); return; }
  const presets = getPresets();
  if (!presets[selectedPreset]) { showToast(`P${selectedPreset+1} j√° est√° vazio`); return; }
  const name = presets[selectedPreset].name;
  presets[selectedPreset] = null;
  savePresets(presets);
  renderPresets();
  showToast(`üóë "${name}" apagado`);
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
let toastTimer = null;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function init() {
  const bar = document.getElementById('loadingBar');
  const msg = document.getElementById('loadingMsg');

  // Check Web Audio API support
  if (!window.AudioContext && !window.webkitAudioContext) {
    msg.textContent = 'Seu navegador n√£o suporta Web Audio API.';
    bar.style.width = '100%';
    bar.style.background = 'var(--red)';
    return;
  }

msg.textContent = 'Construindo interface...';
  bar.style.width = '30%';
  renderKeys();
  renderLayers();
  renderPresets();

  await new Promise(r => setTimeout(r, 300));
  bar.style.width = '70%';
  msg.textContent = 'Carregando sess√£o anterior...';

  // Auto-restore last session
  try {
    const last = localStorage.getItem('worship_last_session');
    if (last) {
      applyConfig(JSON.parse(last));
      msg.textContent = 'Sess√£o restaurada!';
    }
  } catch(e) {}

  await new Promise(r => setTimeout(r, 300));
  bar.style.width = '100%';
  msg.textContent = 'Pronto!';

  await new Promise(r => setTimeout(r, 400));
  document.getElementById('loadingOverlay').classList.add('hidden');
  setTimeout(() => { document.getElementById('loadingOverlay').style.display='none'; }, 600);

  updateMaster();
  updateStatus();

  // Auto-save session every 10 seconds
  setInterval(() => {
    try { localStorage.setItem('worship_last_session', JSON.stringify(buildConfig())); }
    catch(e) {}
  }, 10000);
}

// Handle touch/click to resume audio context (mobile + desktop)
async function resumeCtx() {
  if (ctx && ctx.state === 'suspended') await ctx.resume();
}
document.addEventListener('touchstart', resumeCtx, {once: false, passive: true});
document.addEventListener('click', resumeCtx, {once: false, passive: true});

window.onload = init;

// ‚îÄ‚îÄ Service Worker Registration ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').then(reg => {
      console.log('SW registrado:', reg.scope);
    }).catch(err => {
      console.warn('SW falhou:', err);
    });
  });
}
</script>
</body>
</html>
